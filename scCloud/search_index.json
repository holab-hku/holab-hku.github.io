[
["index.html", "Single Cell RNA-seq Data Cloud Processing Chapter 1 Prerequisites", " Single Cell RNA-seq Data Cloud Processing Ho Lab 2019-12-03 Chapter 1 Prerequisites 1. Command Line Interface (CLI): MacOS Linux Operating System. Windows Subsystem for Linux For Windows Users If you do not have Windows Subsystem for Linux installed you can use PuTTY alternative. Download link: https://putty.org/ "],
["intro.html", "Chapter 2 Introduction", " Chapter 2 Introduction Amazon Web Services provides cloud computing capabilities, which allows on-demand compute power, database, storage, applications, and other IT resources via the internet. This allows extremely flexibile and customisable usage of their products depending on your specific demands/requirements. This could be in the form of computing power, i.e. CPU cores and memory, or data storage space. All requested resources from AWS can be rescaled for your business operations, thus optimising efficiency and cost savings. Set up and usage is also extremely fast and simple, available for usage for all user background types. In this workshop, we will exploit AWS‚Äôs cloud computing service, Elastic Compute Cloud (EC2), to perform single cell 10X genomics RNA-sequencing data processing. Specifically, the mapping of raw transcript reads to an annotated human genome, which is generally a computationally demanding task, requiring more than 32GBs of RAM and numerous threads for efficient/timely processing. 10X genomics single cell RNA-sequencing (scRNA-seq) technology is becoming the most predominant type of scRNA-seq performed due to its high sequencing depth and library preparation technique to capture UMI/cell barcodes. This technology has enabled sequencing on the scale of thousands to millions of individual cells, which generates raw data files much larger than previous bulk sequencing experiements. For this reason, the average local computer generally does not hold enough computing power to perform analysis on this big data. **Quiz** 1. What are some other cloud platforms? 2. What format are raw transcript reads stored as? (a) Fasta (b) Fastq (c) Fastx (d) BAM (e) SAM 3. Estimate the file size of (a) Raw transcript file (b) Aligned reads file (binary compressed format) (c) Feature count matrix "],
["aws-ec2-instance.html", "Chapter 3 AWS EC2 Instance 3.1 Introduction 3.2 Set Up 3.3 Connecting to your EC2 instance 3.4 For PuTTY Users Only", " Chapter 3 AWS EC2 Instance 3.1 Introduction An AWS EC2 instance is equivalent to a portable, customisable, intangible computer which is accessible through your personal local computer with a command line interface. We are able to specify memory requirements, CPU power (computing cores/threads), data storage size, and the operation system (e.g. Linux, Ubuntu, Windows) of this intangible computer. 3.2 Set Up Log into your AWS Account. You will be provided with a username. Log in at https://847709925340.signin.aws.amazon.com/console Username: [userX] Password: scCloud Change your region to US West (N. California) (us-west-1) Navigate to EC2 under Amazon‚Äôs Services tab. Select AMIs under IMAGES tab. Search for ‚ÄúscCloud‚Äù and launch. Launch specfication to use: m5.4xlarge instance type and click ‚ÄúReview and Launch‚Äù. Click ‚ÄúEdit Security Groups‚Äù, Select an existing security group: ‚ÄúscCloud‚Äù, and confirm by clicking ‚ÄúReview and Launch‚Äù. Click Launch. When given the ‚ÄúKey pair‚Äù prompt: select ‚ÄúCreate a new key pair‚Äù. Name your key pair after your username e.g. ‚Äúuser1‚Äù and download the key. Then ‚ÄúLaunch Instances‚Äù **Quiz** 1. What is an AMI? 2. What is the meaning of m5.4xlarge? 3. What is the purpose of a key pair? 3.3 Connecting to your EC2 instance Open your command line interface Connect to your EC2 instance by entering the following command. sudo ssh -i &quot;user1.pem&quot; ec2-user@ec2-XX-XXX-XX-XXX.ap-east-1.compute.amazonaws.com If you do not have ssh installed, run this command: sudo apt install --assume-yes openssh-server ‚Äúuser1.pem‚Äù should be the location of where you have stored your key pair. The X‚Äôs is the ip address of your personal EC2 instance. This can be found by going to EC2 Dashboard &gt; Running Instances &gt; Selecting your running instance &gt; Click Connect. Type ‚Äúyes‚Äù if prompted. **Quiz** 1. What is ssh? 3.4 For PuTTY Users Only 3.4.1 Convert Your Private Key Using PuTTYgen PuTTY does not natively support the private key format for SSH keys. PuTTY provides a tool named PuTTYgen, which converts keys to the required format for PuTTY. You must convert your private key (.pem file) into this format (.ppk file) as follows in order to connect to your instance using PuTTY. From the Start menu, choose All Programs, PuTTY, PuTTYgen. Under Type of key to generate, choose RSA. Choose Load. By default, PuTTYgen displays only files with the extension .ppk. To locate your .pem file, select the option to display files of all types. Select your .pem file for the key pair that you specified when you launched your instance and choose Open. Choose OK. To save the key in the format that PuTTY can use, choose Save private key. PuTTYgen displays a warning about saving the key without a passphrase. Choose Yes. Note A passphrase on a private key is an extra layer of protection. Even if your private key is discovered, it can‚Äôt be used without the passphrase. The downside to using a passphrase is that it makes automation harder because human intervention is needed to log on to an instance, or to copy files to an instance. Specify the same name for the key that you used for the key pair (for example, my-key-pair). PuTTY automatically adds the .ppk file extension. Your private key is now in the correct format for use with PuTTY. You can now connect to your instance using PuTTY‚Äôs SSH client. 3.4.2 Connecting to Your Linux Instance Start PuTTY (from the Start menu, choose All Programs, PuTTY, PuTTY). In the Category pane, choose Session, in the Host Name box, enter ec2-user@public_dns_name (see Get Information About Your Instance for how to get the public DNS name of the instance). For example: ec2-user@ec2-13-56-163-255.ap-east-1.compute.amazonaws.com In the Category pane, expand Connection, expand SSH, and then choose Auth. Complete the following: Choose Browse. Select the .ppk file that you generated for your key pair and choose Open. (Optional) If you plan to start this session again later, you can save the session information for future use. Under Category, choose Session, enter a name for the session in Saved Sessions, and then choose Save. Choose Open "],
["processing-scrna-seq-data.html", "Chapter 4 Processing scRNA-seq data 4.1 Introduction 4.2 Quality Control 4.3 Read Alignment 4.4 STARsolo Output 4.5 Downloading Results from the Cloud 4.6 Terminate your AWS Instance", " Chapter 4 Processing scRNA-seq data 4.1 Introduction Raw RNA-sequencing reads will be in the format of a fastq file. This format describes the read ID, read sequence and sequencing quality scores. Represented in the following format: &gt;ReadID READ SEQUENCE + SEQUENCING QUALITY SCORES You can view your fastq files with: less fastq_file.fastq.gz 4.2 Quality Control Generally fastq files are pre-processed using quality control tools, such as FastQC. This outputs a series of metrics assessing the quality of sequence reads. We will skip this step as we are using a public (pre-checked) scRNA-seq dataset, and limited in time. Some of these metrics include: 1. Per base sequence quality 2. Per sequence quality scores 3. Per base sequence content 4. Per sequence GC content 5. Per base N content 6. Sequence Duplication Levels 7. Overrepresented Sequences 8. Adapter Content 9. Kmer Content For more details: https://rtsf.natsci.msu.edu/genomics/tech-notes/fastqc-tutorial-and-faq/ 4.3 Read Alignment Once confirming adequate sequencing quality of your library, the next goal is to align individual reads to the reference genome whilst retaining information about where the read originated from. The cell barcode from transcript reads capture this information. With the input of a gene annotation file (i.e. GTF file), not only can we decipher the location a read maps to in the genome, but the gene name it corresponds to. This in theory allows the quantification/count of reads which align to each gene/feature of the genome. This is important for downstream analysis where comparitive analysis between single cells occurs and these counts uncover differentially expressed genes. This can eventually lead to inferences such as unique cell type populations. 4.3.1 Building a reference genome index Alignment to a reference genome first requires the generation of an genome index to facilitate the mapping process. This allows looking up parts of the genome in a much faster manner which is neccessary when trying to mapping millions of read sequences. This process saves alots of time and memory when aligning. An analogy to this process is reflected in book indexes. To find a specific part of a book, it is alot faster to look at the chapter indexes first to locate the region of interest instead of looking through every page of the book from top down. Here we can provide an annotation file (.gtf) of the reference genome to provide information about where genes lie within the genome. This step was performed in advanced to save time as it can take up to 1 hour to build a reference index for the human genome. The following command was performed: STAR --runMode genomeGenerate --runThreadN 16 --genomeDir genome_index/ --genomeFastaFiles ref_files/hg38.fa --sjdbGTFfile ref_files/gencode.v32.annotation.gtf The genome index output is located in the folder genome_index. **Quiz** 1. How many base pairs are there in the (a) human (b) mouse genome? 2. What is the file size of the whole human genome DNA sequence? 3. What format is this file in? 4.3.2 Alignment of reads The next step is to map the raw fastq files to the reference genome. In this tutorial we will be using Human CD45+ cells from human melanoma samples, which were sequenced via 10X Genomics and Chromium‚Ñ¢ Single Cell 3‚Äô Reagent Kit (v2). More information about this dataset can be found at https://www.ncbi.nlm.nih.gov/sra/SRX6872900. Paired-end sequencing outputs 2 fastq files corresponding to the 5‚Äô and 3‚Äô direction of sequencing. It is important to recognised the library preparation chemistry used for sequencing in order to determine cell barcode and UMI barcode sequence length and location. This allows the mapping algorithm to distinguish which sequences are barcodes and which are transcript sequences. **Quiz** 1. What is the difference between a cell barcode and UMI barcode? and what are their significance? 2. What are the lengths of the cell barcode and UMI barcode used in our dataset? 3. Are these barcodes located on the 5&#39; or 3&#39; read file? Generally 10X Genomics scRNA-Seq reads are aligned using the tool Cell Ranger. It is a wrapper to the open source alignment tool, STAR by Alexander Dobin, which optimises algorithms to handle the sequencing chemistry of 10X genomic library preparation. This includes UMI counting and calling cell barcodes. More information can be found at https://support.10xgenomics.com/single-cell-gene-expression/software/pipelines/latest/algorithms/overview. In this workshop we will be using a recently developed application of STAR, STARsolo, which is an effective solution to handle droplet-based scRNA-seq data analysis. It provides an output similar to Cell Ranger which is important for downstream analysis packages such as Seurat. STARsolo also performs extremely fast read alignment of single cell raw reads from 10X genomics. It claims to be 10 times faster than Cell Ranger. More details can be found in the latest version of STAR manual: https://github.com/alexdobin/STAR/blob/master/doc/STARmanual.pdf. Some of the key functions of STARsolo are: 1. Error correction and demultiplexing of cell barcodes using user-input whitelist. 2. Mapping the reads to the reference genome using the standard STAR spliced read alignment algorithm. 3. Error correction and collapsing (deduplication) of Unique Molecular Identifiers (UMIs). 4. Quantification of per-cell gene expression by counting the number of reads per gene. Create an output directory called ‚Äústarsolo_out‚Äù. üî¥ mkdir starsolo_out üî¥ Run the following command to perform read alignment: STAR --genomeDir genome_index/ --soloType Droplet --soloCBwhitelist barcode_whitelist/10X_v2.txt --runThreadN 16 --readFilesCommand zcat --readFilesIn fastq/MelanomaT_CD45plus_IGO_07734_S5_L002_R2_001.fastq.gz fastq/MelanomaT_CD45plus_IGO_07734_S5_L002_R1_001.fastq.gz --outFileNamePrefix ~/starsolo_out/ This step can take several minutes. Please work through the quiz questions in the meanwhile and ask questions! **Quiz** 1. Describe the function of each parameter in the sequence alignment command. 2. What are some different types of scRNA-sequencing methods other than droplet based? And describe their differences. 4.4 STARsolo Output The STARsolo program outputs a large amount of files reflecting details of the read alignment process. We will only discuss some of the key files important for downstream analysis. The BAM file, contains information about mapped reads, in a binary compressed format. When de-compressed into a SAM file, information is stored as a tab seperated table where the columns corresponds to: QNAME : read name (generally will include UMI barcode if applicable) FLAG : number tag indicating the ‚Äútype‚Äù of alignment, link to explanation of all possible ‚Äútypes‚Äù RNAME : reference sequence name (i.e. chromosome read is mapped to). POS : leftmost mapping position MAPQ : Mapping quality CIGAR : string indicating the matching/mismatching parts of the read (may include soft-clipping). RNEXT : reference name of the mate/next read PNEXT : POS for mate/next read TLEN : Template length (length of reference region the read is mapped to) SEQ : read sequence QUAL : read quality BAM files can be viewed using SAMtools. samtools view output.bam Alignment summary files, Features.stat and Summary.csv, contains information about basic mapping details. This can serve as an easy preliminary quality control check of the alignment process. The feature matrix file, matrix.mtx, contains information about the counts of genes mapped in each individual cell. The column names corresponds to each individual cell barcode, and the row names corresponds to all annotated genes. Due to the large size of this data, it is stored as a sparse matrix. Auxiliary files, barcodes.tsv and features.tsv, provide extra metadata important for downstream analysis. These files along with the matrix file are required for analysis in gold standard scRNA-seq data analysis package, seurat. 4.5 Downloading Results from the Cloud After the generation of your alignment results and feature count data, you may want to download the data locally for downstream analysis and minimise costs associated with maintaining your aws cloud instance. Run the following command from your local command line system to copy your entire output folder. scp -i ~/path/to/user1.pem -r ec2-user@ec2-XX-XX-XXX-XX.ap-east-1.compute.amazonaws.com:~/path/to/output_foler ~/path/to/target/download_location 4.6 Terminate your AWS Instance Remember to terminate your AWS instance to prevent costs associated with usage. This can be performed by navigating to the EC2 dashboard &gt; Running Instances. Then select your running instance &gt; Actions &gt; Instance State &gt; Terminate. Note: This will remove all data files stored on the instance so make your to backup any required data files either locally or by using Amazon‚Äôs data storage service, S3 Bucket. "],
["scrna-seq-downstream-analysis.html", "Chapter 5 scRNA-seq Downstream Analysis 5.1 Seurat Package", " Chapter 5 scRNA-seq Downstream Analysis 5.1 Seurat Package Seurat is an R package designed for QC, analysis, and exploration of single-cell RNA-seq data. Seurat aims to enable users to identify and interpret sources of heterogeneity from single-cell transcriptomic measurements, and to integrate diverse types of single-cell data. The format of output results from both Cell Ranger and STARsolo stream nicely into the Seurat defualt analysis pipeline. We will not demonstrate this process but only highlight the types of insights/plots you can achieve from this data analysis. More information can be found at https://satijalab.org/seurat. 5.1.1 Differentially expressed Genes 5.1.2 Cell Clustering 5.1.3 Analysis of Variable Gene Markers 5.1.4 Heatmap of gene expression by clusters "],
["references.html", "Chapter 6 References", " Chapter 6 References Dobin, A., Davis, C. A., Schlesinger, F., Drenkow, J., Zaleski, C., Jha, S., ‚Ä¶ Gingeras, T. R. (2013). STAR: Ultrafast universal RNA-seq aligner. Bioinformatics, 29(1), 15‚Äì21. https://doi.org/10.1093/bioinformatics/bts635 "]
]
